<!DOCTYPE html>
<html lang="en">

<head>

  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
  <meta name="description" content="">
  <meta name="author" content="">

  <title>AHB Algorithm: AME Lab</title>

  <!-- Bootstrap core CSS -->
  <link href="vendor/bootstrap/css/bootstrap.min.css" rel="stylesheet">

  <!-- Custom styles for this template -->
  <link href="simple-sidebar.css" rel="stylesheet">
  <!--Additional custom styling -->
  <link href="additional.css" rel="stylesheet">
  <link href="https://maxcdn.bootstrapcdn.com/font-awesome/4.7.0/css/font-awesome.min.css" rel="stylesheet"/>

</head>

<body>




  <div class="d-flex" id="wrapper">

<!-- Sidebar -->
    <div class="bg-light border-right" id="sidebar-wrapper"><div id="sidebar-content">
	  <a href="index.html"><div class="sidebar-heading sidebar-heading-logo"><img class = "logo-alt2" src = "logos/logo_alt2.svg" alt = "duke logo"></div></a>
      <div class="list-group list-group-flush">
		<a href="about-us.html" class="list-group-item list-group-item-action bg-light">About Us</a>
        <a href="choosing-an-algorithm.html" class="list-group-item list-group-item-action bg-light">Choosing an Algorithm</a>
		<a id="flip" class="dropdown-btn list-group-item list-group-item-action bg-light" style="color:#495057">Getting Started<i class="fa fa-chevron-down" style="font-size:16px"></i></a>
        <div id="flipped" class="dropdown-container">
          <a href="dame.html" class="list-group-item list-group-item-action bg-light">DAME</a>
          <a href="flame.html" class="list-group-item list-group-item-action bg-light">FLAME</a>
          <a href="malts.html" class="list-group-item list-group-item-action bg-light">MALTS</a>
		  <a href="ahb.html" class="list-group-item list-group-item-action bg-light">AHB</a>
        </div>
        <a href="tutorials.html" class="list-group-item list-group-item-action bg-light">Tutorials</a>
        <a href="additional-resources.html" class="list-group-item list-group-item-action bg-light">Additional Resources</a>
      </div>
    </div></div>
    <!-- /#sidebar-wrapper -->

    <!-- Page Content -->
    <div id="page-content-wrapper">

      <nav class="navbar navbar-expand-lg navbar-light bg-light border-bottom">
        <button class="navbar-toggler" id="menu-toggle" onclick="changeMenuText()"><span id="menuText"><span class="navbar-toggler-icon"></span></button>
        <ul class="navbar-nav ml-auto mt-lg-0">
          <a class="nav-link" href="https://github.com/almost-matching-exactly" target="_blank"><i class="fa fa-github"></i> Github</a>
        </ul>
      </nav>

      <div class="container-fluid" style="padding-bottom: 50px">
        <div class="banner"><h1 class="title mt-4">Getting Started with AHB</h1></div> 
          <div class="container">
		  <div class="container">
		    <h2 style="padding-bottom:0px !important" class="languageHeader"><a id="pTab" class="languageTab languageActive">R Package</a></h2><hr class="languageHr">
			<div class="container">
			Please note that this package requires the installation of R version 3.3 or higher. 
			If you do not already have an updated version of R installed on your computer, you can find instructions on how to download the latest version <a href="https://www.r-project.org/" target="_blank">here</a>.
			This package also contains Python dependencies like Rcpp, which requires you to install Cplex first. If you do not already have an updated version of Cplex installed on your computer, you can find instructions on how to download and install it <a href="http://www-stat.wharton.upenn.edu/~josezubi/INSTALL/" target="_blank">here</a>.
			</div>
			<h3 style="padding-top: 15px">Installation</h3>
				  <div class="container">
					<p>AHB, along with its R dependencies, can be installed directly from CRAN via the following command:</p>
					<div class="code"><pre style="white-space:nowrap"><span id="codesampleR1">install.packages('AHB')</span></pre>
					<button class="codeButton" onclick="codeCopy('codesampleR1');showToast();borderFix()"><i class="fa fa-clipboard" style="font-size:16px"></i></button></div>
					<div id="toast">Copied to clipboard!</div>
				  </div>
			<h3>Input Data Format</h3>
				  <div class="container">
				    To begin using the R-AHB algorithm, first ensure that your dataset is stored as an <b>R Data Frame</b>. 
					Remember, covariates can either be categorical, continuous, or mixed (categorical and continuous). In addition to the covariate columns, your dataset should include a column of 
					<i>binary</i> or <i>logical</i> data types which specify whether a unit is treated (1) or control (0) 
					and a column of <i>numeric</i> data types which specify unit outcomes. 
					Below is a sample dataset in the required format:
					<div class="input-data-container">
					  <div class="row" style="width:100%; margin-right:-15px">
						<div class="col">
						  <table class="table table-striped" style="margin-bottom:15px;margin-top:15px;width:95%;margin-left:auto;margin-right:auto">
							<thead>
							  <tr style="text-align:center">
								<th>x_1 <span style="font-weight:normal;font-style:italic">(numeric)</span></th>
								<th>x_2 <span style="font-weight:normal;font-style:italic">(numeric)</span></th>
								<th>...</th>
								<th>x_m <span style="font-weight:normal;font-style:italic">(numeric)</span></th>
								<th>treated <span style="font-weight:normal;font-style:italic">(binary or logical)</span></th>
								<th>outcome <span style="font-weight:normal;font-style:italic">(numeric)</span></th>
							  </tr>
							</thead>
							<tbody>
							  <tr style="text-align:center">
								<td>3</td>
								<td>2.0529</td>
								<td>...</td>
								<td>4.7905</td>
								<td>1</td>
								<td>4.5321</td>
							  </tr>
							  <tr style="text-align:center">
								<td>0</td>
								<td>3.9932</td>
								<td>...</td>
								<td>7.6513</td>
								<td>0</td>
								<td>3.3348</td>
							  </tr>
							  <tr style="text-align:center">
								<td>...</td>
								<td>...</td>
								<td>...</td>
								<td>...</td>
								<td>...</td>
								<td>...</td>
							  </tr>
							  <tr style="text-align:center">
								<td>1</td>
								<td>6.9321</td>
								<td>...</td>
								<td>1.5848</td>
								<td>1</td>
								<td>6.9320</td>
							  </tr>
							</tbody>
						  </table>
						</div>
					  </div>	
					</div>				
				  </div>			
			<h3>Usage</h3>
				<div class="container">
					To generate sample data for exploring AHB matching functionality, use the function <span class="function">gen_data</span> as shown below. 
					Remember to load the 'AHB' package a shown in line 1 before calling any of the functions discussed in this section.
					This example generates a data frame with n = 50 units and p = 5 covariates:
<span id="codesampleR0" style="display:none">library('AHB')
set.seed(45)
n <- 50
p <- 5
data <- gen_data(n_units = n, p = p)
holdout <- gen_data(n_units = n, p = p) </span>
  
<div class="code" style="margin-top:15px"><pre><span class="import">library</span>(<span class="Rstring">'AHB'</span>)
set.seed(45)
n <- 50
p <- 5
data <- <b>gen_data</b>(n_units = <span class="Rnumber">n</span>, p = <span class="Rnumber">p</span>)
holdout <- <b>gen_data</b>(n_units = <span class="Rnumber">n</span>, p = <span class="Rnumber">p</span>)</pre>
					<button class="codeButton" onclick="codeCopy('codesampleR0');showToast();borderFix()"><i class="fa fa-clipboard"></i></button></div>
					To run the algorithm, use the <span class="function">AHB_fast_match</span>  or <span class="function">AHB_MIP_match</span>function as shown below. The required data parameter can either be
					a path to a .csv file or a dataframe. In this example, data and holdout generated above are used:					
<span id="codesampleR3" style="display:none">AHB_MIP_out <- AHB_MIP_match(data = data, holdout = holdout, treated_column_name="treated", outcome_column_name="outcome")
AHB_fast_out <- AHB_fast_match(data = data, holdout = holdout, treated_column_name="treated", outcome_column_name="outcome")</span>
<div class="code" style="margin-top:15px"><pre>
AHB_MIP_out <- <b>AHB_MIP_match</b>(data = data,  holdout = holdout, treated_column_name=<span class="Rstring">"treated"</span>, outcome_column_name=<span class="Rstring">"outcome"</span>)
AHB_fast_out <- <b>AHB_fast_match</b>(data = data,  holdout = holdout, treated_column_name=<span class="Rstring">"treated"</span>, outcome_column_name=<span class="Rstring">"outcome"</span>)</pre>
					<button class="codeButton" onclick="codeCopy('codesampleR3');showToast();borderFix()"><i class="fa fa-clipboard"></i></button></div>
					Take <span style="font-weight:600">AHB_fast_out</span> as an axample to illustrate the output of the AHB matching alogrithms. The object <span style="font-weight:600">AHB_fast_out</span> is a list of five entries:<br>
					<div class="row">
						<div class="col">
						  <table class="table" style="margin-bottom:15px;margin-top:15px;width:95%;margin-left:auto;margin-right:auto">
							<tbody>
								<tr>
									<td><span style="font-weight:600">AHB_fast_out$data:</span></td>
									<td>Data set was matched by <b>AHB_fast_match()</b>. If holdout is not a numeric value, the <b>AHB_fast_out$data</b> is the same as the data input into <b>AHB_fast_match()</b>.  If holdout is a numeric scalar between 0 and 1,  <b>AHB_fast_out$data</b> is the remaining proportion of data that were matched.</td>
								</tr><tr>
									<td><span style="font-weight:600">AHB_fast_out$units_id:</span></td>
									<td>A integer vector with unit_id for test treated units</td>
								</tr><tr>
									<td><span style="font-weight:600">AHB_fast_out$CATE:</span></td>
									<td>A numeric vector with the conditional average treatment effect estimates for every test treated unit in its matched group in <b>AHB_fast_out$MGs</b></td>
								</tr><tr>
									<td><span style="font-weight:600">AHB_fast_out$bins:</span></td>
									<td>A numeric vector with the conditional average treatment effect estimates for every test treated unit in its matched group in <b>AHB_fast_out$MGs</b></td>
								</tr><tr>
									<td><span style="font-weight:600">AHB_fast_out$MGs:</span></td>
									<td>A list of all the matched groups formed by <b>AHB_fast_match()</b>. For each test treated unit, each row contains all unit_id of the other units that fall into its box, including itself.</td>
								</tr>
							</tbody>
						  </table>
						</div>
					</div>
					To find the average treatment effect (ATE) or average treatment effect on the treated (ATT), use the functions <span class="function">ATE</span> 
					and <span class="function">ATT</span>, respectively, as shown below:
<span id="codesampleR6" style="display:none">ATE(AHB_out = AHB_fast_out)
ATT(AHB_out = AHB_fast_out)</span>
<div class="code" style="margin-top:15px"><pre><b>ATE</b>(AHB_out = AHB_fast_out)
<b>ATT</b>(AHB_out = AHB_fast_out)</pre>
					<button class="codeButton" onclick="codeCopy('codesampleR6');showToast();borderFix()"><i class="fa fa-clipboard"></i></button></div>
			  </div>						
			<h3>AHB - Parameters and Defaults</h3>
				<div class="container">
<div class="pre-nonumbers" style="margin-top:15px"><b>AHB_fast_match</b>(data, holdout = <span class="Rnumber">0.1</span>, treated_column_name = <span class="Rstring">&quot;treated&quot;</span>,
outcome_column_name = <span class="Rstring">&quot;outcome&quot;</span>, black_box = <span class="Rstring">&quot;BART&quot;</span>, cv = <span class="import">T</span>, C = <span class="Rnumber">0.1</span>)</div>

<div class="pre-nonumbers" style="margin-top:15px"><b>AHB_MIP_match</b>(data, holdout = <span class="Rnumber">0.1</span>, treated_column_name = <span class="Rstring">&quot;treated&quot;</span>,
outcome_column_name = <span class="Rstring">&quot;outcome&quot;</span>, black_box = <span class="Rstring">&quot;BART&quot;</span>, cv = <span class="import">T</span>, gamma0 = <span class="Rnumber">3</span>, gamma1 = <span class="Rnumber">3</span>, 
Beta = <span class="Rnumber">2</span>, m = <span class="Rnumber">1</span>, M = <span class="Rnumber">1e+05</span>, n_prune = <span class="function">ifelse(is.numeric(holdout), round(0.1 * (1 - holdout) * nrow(data)), round(0.1 * nrow(data)))</span>)</div>

					<a onclick="expandAll(['RflameKey','RflameEarly']);minusAll(['RplusKey','RplusEarly'])" class="expand-all">Expand all</a>
					<a onclick="collapseAll(['RflameKey','RflameEarly']);plusAll(['RplusKey','RplusEarly'])" class="expand-all">Collapse all</a>
					<div class="parameter-container">
					<h4 style="margin-top: 15px">Key Parameters for AHB_fast_match<i id="RplusKey" onclick="expand('RflameKey');minus(this.id)" class="fa fa-minus-square-o"></i></h4>
					<div id="RflameKey">
						<div class="row">
							<div class="col">
								<table class="table table-striped" style="margin-top:15px;margin-bottom:15px;width:95%;margin-left:auto;margin-right:auto">
									<tbody>
										<tr>
											<td class="pwidth"><b>data:</b><br>file, Dataframe, required</td>
											<td>If holdout is not a numeric value, this is the data to be matched. If holdout is a numeric scalar between 0 and 1, that proportion of data will be made into a holdout set and only the remaining proportion of data will be matched. </td>
										</tr><tr>
											<td><b>holdout:</b><br>numeric, file, Dataframe, optional (default = 0.1)</td>
											<td>Holdout data used to train the outcome model. If a numeric scalar, that proportion of <b>data</b> will be made into a holdout set and only the remaining proportion of <b>data</b> will be matched. Otherwise, if a file path or dataframe is provided, that dataset will serve as the holdout data.</td>
										</tr><tr>
											<td><b>treated_<wbr>column_<wbr>name:</b><br>string, optional (default = 'treated')</b></td>
											<td>The name of the column which specifies whether a unit is treated or control.</td>
										</tr><tr>
											<td><b>outcome_<wbr>column_<wbr>name:</b><br>string, optional (default = 'outcome')</td>
											<td>The name of the column which specifies each unit outcome.</td>
										</tr><tr>
											<td><b>black_<wbr>box</b><br>string, optional (default = 'BART)</td>
											<td>Denotes the method to be used to generate outcome model Y. If "BART" and cv = F, uses dbarts::bart with keeptrees = TRUE, keepevery = 10, verbose = FALSE, k = 2 and ntree =200 and then the default predict method to estimate the outcome. If "BART" and cv = T, k and ntree will be best values from cross validation. Defaults to 'BART'. There will be multiple choices about black_box in the future.</td>
								        </tr><tr>
											<td><b>cv</b><br>logical, optional (default = T)</td>
											<td>If TURE, do cross-validation on the train set to generate outcome model Y</td>
										</tr><tr>
											<td><b>C</b><br>A positive scalar, optional (default = 0.1)</td>
											<td>Determines the stopping condition for Fast AHB. When the variance in a newly expanded region exceeds C times the variance in the previous expansion region, the algorithm stops. Thus, higher C encourages coarser bins while lower C encourages finer ones. The user should analyze the data with multiple values of C to see how robust results are to its choice.</td>
										</tr>
									</tbody>
								</table>
							</div>
						</div>
					</div>
					<h4 style="margin-top:15px">Key Parameters for AHB_MIP_match<i id="RplusEarly" onclick="expand('RflameEarly');minus(this.id)" class="fa fa-minus-square-o"></i></h4>
					<div id="RflameEarly">
					<div class="row">
						<div class="col">
						  <table class="table table-striped" style="margin-bottom:15px;width:95%;margin-left:auto;margin-right:auto">
							<tbody>
								<tr>
									<td class="pwidth"><b>data:</b><br>file, Dataframe, required</td>
									<td>If holdout is not a numeric value, this is the data to be matched. If holdout is a numeric scalar between 0 and 1, that proportion of data will be made into a holdout set and only the remaining proportion of data will be matched. </td>
								</tr><tr>
									<td><b>holdout:</b><br>numeric, file, Dataframe, optional (default = 0.1)</td>
									<td>Holdout data used to train the outcome model. If a numeric scalar, that proportion of <b>data</b> will be made into a holdout set and only the remaining proportion of <b>data</b> will be matched. Otherwise, if a file path or dataframe is provided, that dataset will serve as the holdout data.</td>
								</tr><tr>
									<td><b>treated_<wbr>column_<wbr>name:</b><br>string, optional (default = 'treated')</b></td>
									<td>The name of the column which specifies whether a unit is treated or control.</td>
								</tr><tr>
									<td><b>outcome_<wbr>column_<wbr>name:</b><br>string, optional (default = 'outcome')</td>
									<td>The name of the column which specifies each unit outcome.</td>
								</tr><tr>
									<td><b>black_box</b><br>string, optional (default = 'BART)</td>
									<td>Denotes the method to be used to generate outcome model Y. If "BART" and cv = F, uses dbarts::bart with keeptrees = TRUE, keepevery = 10, verbose = FALSE, k = 2 and ntree =200 and then the default predict method to estimate the outcome. If "BART" and cv = T, k and ntree will be best values from cross validation. Defaults to 'BART'. There will be multiple choices about black_box in the future.</td>
								</tr><tr>
									<td><b>cv</b><br>logical, optional (default = T)</td>
									<td>If TURE, do cross-validation on the train set to generate outcome model Y</td>
								</tr><tr>
									<td><b>gamma0</b><br>A numeric scalar, optional (default = 3)</td>
									<td>A numeric value, one of hyperparameters in global MIP that controls the weight placed on the outcome function portion of the loss. </td>
								</tr><tr>
									<td><b>gamma1</b><br>A numeric scalar, optional (default = 3)</td>
									<td>A numeric value, one of hyperparameters in global MIP that controls the weight placed on the outcome function portion of the loss. </td>
								</tr><tr>
									<td><b>beta</b><br>A numeric scalar, optional (default = 2)</td>
									<td>A numeric value, one of hyperparameters in global MIP that controls the weight placed on the outcome function portion of the loss. </td>
								</tr><tr>
									<td><b>m</b><br>A integer scalar, optional (default = 1)</td>
									<td>Determines the at least number of control units that the box contains when estimating causal effects for a single treatment unit.</td>
								</tr><tr>
									<td><b>M</b><br>A positive integer scalar, optional (default = 1e+5)</td>
									<td>Controls the weight placed on decision variable wij, which is an indicator for whether a unit is in the box.</td>
								</tr><tr>
									<td><b>n_prune</b><br>A positive inetger scalar, optional (default = 0.1* nrow(dataset to be matched))</td>
									<td>Determines the number of candidate units selected to run the mip on for constructing the box. Dataset mentioned below is refered to the dataset for matching. If you match a small dataset with the number of units smaller than 400, it will run MIP on all dataset for each treated unit. If you match larger dataset and your memory of your computer cannot support such much computation, plase adjust n_prune below 400 or even smaller. The smaller number of candidate units selected to run the mip on for constructing the box, the faster this program runs.</td>
								</tr>
							</tbody>
						  </table>
						</div>
					</div>
					</div>
					</div>
					<h3 style="margin-top:25px">Additional Functions - Parameters and Defaults</h3>
				  <div class="container">
<div class="pre-nonumbers" style="margin-top:15px"><span class="comment">#returns average treatment effect</span>
<b>ATE</b>(AHB_out)

<span class="comment">#returns average treatment effect on the treated</span>
<b>ATT</b>(AHB_out)</div>
				    <div class="parameter-container">
					<h4>Key Parameters<i id="plusAdditional" onclick="expand('flameAdditional');minus(this.id)" class="fa fa-minus-square-o"></i></h4>
					<div id="flameAdditional"></h4>
					<div class="row">
						<div class="col">
						  <table class="table table-striped" style="margin-bottom:15px;width:95%;margin-left:auto;margin-right:auto">
							<tbody>
							  <tr>
								<td class="pwidth"><b>AHB_out:</b><br>Dataframe, required</td>
								<td>The output of a call to AHB.</td>
							  </tr>
							</tbody>
						  </table>
						</div>
					</div>
					</div>
					</div>
				</div>
					</div>
				</div>
		  </div>
		</div><!--Container containing all the stuff-->
    </div>
    <!-- /#page-content-wrapper -->

  </div>
  <!-- /#wrapper -->

  <!-- Bootstrap core JavaScript -->
  <script src="vendor/jquery/jquery.min.js"></script>
  <script src="vendor/bootstrap/js/bootstrap.bundle.min.js"></script>

  <!-- Menu Toggle Script -->
  <script>
    $("#menu-toggle").click(function(e) {
      e.preventDefault();
      $("#wrapper").toggleClass("toggled");
    });
  </script>
  <!-- Additional Custom Script -->
  <script src="additionaljs.js"></script>
</body>

</html>
