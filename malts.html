<!DOCTYPE html>
<html lang="en">

<head>

  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
  <meta name="description" content="">
  <meta name="author" content="">

  <title>MALTS Algorithm: AME Lab</title>

  <!-- Bootstrap core CSS -->
  <link href="vendor/bootstrap/css/bootstrap.min.css" rel="stylesheet">

  <!-- Custom styles for this template -->
  <link href="simple-sidebar.css" rel="stylesheet">
  <!--Additional custom styling -->
  <link href="additional.css" rel="stylesheet">
  <link href="https://maxcdn.bootstrapcdn.com/font-awesome/4.7.0/css/font-awesome.min.css" rel="stylesheet"/>

</head>

<body>

  <div class="d-flex" id="wrapper">

<!-- Sidebar -->
    <div class="bg-light border-right" id="sidebar-wrapper"><div id="sidebar-content">
	  <a href="index.html"><div class="sidebar-heading sidebar-heading-logo"><img class = "logo-alt2" src = "logos/logo_alt2.svg" alt = "duke logo"></div></a>
      <div class="list-group list-group-flush">
		<a href="about-us.html" class="list-group-item list-group-item-action bg-light">About Us</a>
        <a href="choosing-an-algorithm.html" class="list-group-item list-group-item-action bg-light">Choosing an Algorithm</a>
		<a id="flip" class="dropdown-btn list-group-item list-group-item-action bg-light" style="color:#495057">Getting Started<i class="fa fa-chevron-down" style="font-size:16px"></i></a>
        <div id="flipped" class="dropdown-container">
          <a href="dame.html" class="list-group-item list-group-item-action bg-light">DAME</a>
          <a href="flame.html" class="list-group-item list-group-item-action bg-light">FLAME</a>
          <a href="malts.html" class="list-group-item list-group-item-action bg-light">MALTS</a>
		  <a href="ahb.html" class="list-group-item list-group-item-action bg-light">AHB</a>
        </div>
        <a href="tutorials.html" class="list-group-item list-group-item-action bg-light">Tutorials</a>
        <a href="additional-resources.html" class="list-group-item list-group-item-action bg-light">Additional Resources</a>
      </div>
    </div></div>
    <!-- /#sidebar-wrapper -->

    <!-- Page Content -->
    <div id="page-content-wrapper">

      <nav class="navbar navbar-expand-lg navbar-light bg-light border-bottom" style="height:61px">
        <button class="navbar-toggler" id="menu-toggle" onclick="changeMenuText()"><span id="menuText"><span class="navbar-toggler-icon"></span></button>
        <ul class="navbar-nav ml-auto mt-lg-0">
          <a class="nav-link" href="https://github.com/almost-matching-exactly" target="_blank"><i class="fa fa-github"></i> Github</a>
        </ul>
      </nav>

      <div class="container-fluid" style="padding-bottom: 50px">
        <div class="banner"><h1 class="title mt-4">Getting Started with MALTS</h1></div> 
          <div class="container">
		    <h2 style="padding-bottom:0px !important" class="languageHeader">
		    <a id="pTab" class="languageTab languageActive">Python Package</a></h2><hr class="languageHr">
		<div class="container">
					<div class="container">
					Please note that this package requires the installation of Python version 3 or higher. 
					If you do not already have an updated version of Python installed on your computer, you can download the latest version <a href="https://www.python.org/downloads/" target="_blank">here</a>.
					Additionally, this package is dependent on Pandas, Scikit-learn, and Numpy. If your version of Python does not have these packages, you can install them <a href="https://packaging.python.org/tutorials/installing-packages/" target="_blank">here</a>.
					We recommend installing the <a href="https://www.anaconda.com/products/individual" target="_blank">Anaconda package</a>, which comes with the Python libraries our software is dependent on already pre-installed.
					</div>
				<h3 style="padding-top: 15px">Installation</h3>
					<div class="container">
					<p>MALTS is currently available in Python for download on the <a href="https://github.com/almost-matching-exactly" target="_blank">almost-matching-exactly Github</a> or for installation via PyPi (recommended). The package including the MALTS algorithm can be installed with the following command:<p>
					<div class="code"><pre style="white-space:nowrap"><span id="codesample1">pip install pymalts2</span></pre><button class="codeButton" onclick="codeCopy('codesample1');showToast();borderFix()"><i class="fa fa-clipboard" style="font-size:16px"></i></button></div>
					<div id="toast">Copied to clipboard!</div>
				  </div>
				<h3>Input Data Format</h3>
				<div class="container">
				To begin using the MALTS algorithm, first ensure that your dataset meets the necessary requirements. The data can be stored as a CSV/Excel file or as a <b>Python Pandas Data Frame</b>.
				MALTS was designed for continuous covariates, where different covariates can be stored as <i>float</i>, <i>double</i> or even <i>integer</i> data types. For categorical datatypes, please consider using <b>DAME</b> or <b>FLAME</b> instead, unless the different categories have a specific binning sequence.
				In addition to the covariate columns, your dataset should include a column of binary <i>integer</i> data types which specify whether a unit is treated (1) or control (0) 
					and a column of <i>integer</i> or <i>float</i> data types which specify unit outcomes. There are no requirements for covariate column names or the ordering of the columns. 
					Below is a sample dataset in the required format:
										  <div class="row">
						<div class="col">
						  <table class="table table-striped" style="margin-bottom:15px;margin-top:15px;width:95%;margin-left:auto;margin-right:auto">
							<thead>
							  <tr style="text-align:center">
								<th>x_1 <span style="font-weight:normal;font-style:italic">(numeric)</span></th>
								<th>x_2 <span style="font-weight:normal;font-style:italic">(numeric)</span></th>
								<th>...</th>
								<th>x_m <span style="font-weight:normal;font-style:italic">(numeric)</span></th>
								<th>treated <span style="font-weight:normal;font-style:italic">(binary)</span></th>
								<th>outcome <span style="font-weight:normal;font-style:italic">(numeric)</span></th>
							  </tr>
							</thead>
							<tbody>
							  <tr style="text-align:center">
								<td>1.3276</td>
								<td>2.0529</td>
								<td>...</td>
								<td>4.7905</td>
								<td>1</td>
								<td>4.5321</td>
							  </tr>
							  <tr style="text-align:center">
								<td>2.62</td>
								<td>3.9932</td>
								<td>...</td>
								<td>7.6513</td>
								<td>0</td>
								<td>3.3348</td>
							  </tr>
							  <tr style="text-align:center">
								<td>...</td>
								<td>...</td>
								<td>...</td>
								<td>...</td>
								<td>...</td>
								<td>...</td>
							  </tr>
							  <tr style="text-align:center">
								<td>2.2973</td>
								<td>6.9321</td>
								<td>...</td>
								<td>1.5848</td>
								<td>1</td>
								<td>6.9320</td>
							  </tr>
							</tbody>
						  </table>
						</div>
					  </div>
				</div>
				<!--Sample Data Over-->
				<h3>Usage</h3>
				<div class="container">
				To run the algorithm, we first need to import the necessary libraries required, and import the dataset as a Pandas DataFrame.
				<span id="codesample2" style="display:none">import pymalts2 as pymalts
import numpy as np
import pandas as pd
import matplotlib.pyplot as plt
import seaborn as sns
np.random.seed(0)
sns.set()
df = pd.read_csv('data.csv',index_col=0)
				</span>
				
				<div class="code" style="margin-top:15px"><pre><span class="import">import</span> pymalts2 <span class="import">as</span> pymalts
<span class="import">import</span> numpy <span class="import">as</span> np
<span class="import">import</span> pandas <span class="import">as</span> pd
<span class="import">import</span> matplotlib.pyplot <span class="import">as</span> plt
<span class="import">import</span> seaborn <span class="import">as</span> sns
np.random.seed(0)
sns.set(0)
df = pd.read_csv(<span class="string">&quot;data.csv&quot;</span>, index_col=0)</pre>
					<button class="codeButton" onclick="codeCopy('codesample2');showToast();borderFix()"><i class="fa fa-clipboard"></i></button>
				</div>
				To set up the model, we call the <span class="function">malts_mf</span> function from the <span class="function">pymalts</span> module, and specify which columns are the treatment variable and the outcome variable. The <span class="function">MG_matrix</span> denotes
				the matrix with rows denoting query units and the columns denoting matched units. The weight ( the value in the cell (i,j) ) corresponds to the numbers of times a unit is included in a matched group across M-folds.
				<span id="codesample3" style="display:none">m = pymalts.malts_mf( outcome='outcome', treatment='treated', data=df)
print (m.MG_matrix)			
				</span>
				<div class="code" style="margin-top:15px"><pre>m = pymalts.<b>malts_mf</b>( outcome=<span class="string">'outcome'</span>, treatment=<span class="string">'treated'</span>, data=df)
<span class="print">print</span> (m.MG_matrix)</pre><button class="codeButton" onclick="codeCopy('codesample3');showToast();borderFix()"><i class="fa fa-clipboard"></i></button></div>
				We can use this <span class="function">MG_Matrix</span> to visualize the weights for the matched group for a particular unit, and plot that on bar charts.
								<span id="codesample4" style="display:none">MG1 = m.MG_matrix.loc[1] 
MG1[MG1>1].sort_values(ascending=False).plot(kind='bar',figsize=(20,5))</span>
<div class="code" style="margin-top:15px"><pre>MG1 = m.MG_matrix.loc[1] 
MG1[MG1>1].sort_values(ascending=<span class="print">False</span>).<span class="print">plot</span>(kind=<span class="string">'bar'</span>,figsize=(20,5))</pre><button class="codeButton" onclick="codeCopy('codesample4');showToast();borderFix()"><i class="fa fa-clipboard"></i></button></div>
				To find the conditional average treatment effect <span class="function">CATE</span> and the average treatment effect <span class="function">ATE</span>, we can output the <span class="function">CATE_df</span> dataframe, storing the data. The mean value of the <span class="function">avg.CATE</span> column
				gives the value of <span class="function">ATE</span> for the dataset. We can visualize the <span class="function">ATE</span> and the probability density function of the <span class="function">CATE</span> in graphs.
				<span id="codesample5" style="display:none">print (m.CATE_df)
ATE = m.CATE_df['avg.CATE'].mean()
print (ATE)
fig = plt.figure(figsize=(10,5))
sns.kdeplot(m.CATE_df['avg.CATE'],shade=True)
plt.axvline(ATE,c='black')
plt.text(ATE-4,0.04,'$\hat{ATE}$',rotation=90)</span>

<div class="code" style="margin-top:15px"><pre>ATE = m.<b>CATE_df</b>[<span class="string">'avg.CATE'</span>].mean()
<span class="print">print</span> (ATE)
fig = plt.<span class="print">figure</span>(figsize=(10,5))
sns.<span class="print">kdeplot</span>(m.CATE_df[<span class="string">'avg.CATE'</span>],shade=<span class="print">True</span>)
plt.<span class="print">axvline</span>(ATE,c=<span class="string">'black'</span>)
plt.<span class="print">text</span>(ATE-4,0.04,<span class="string">'$\hat{ATE}$'</span>,rotation=90)</pre><button class="codeButton" onclick="codeCopy('codesample5');showToast();borderFix()"><i class="fa fa-clipboard"></i></button></div>				
				</div><!--container over-->
				
				
				<h3>MALTS - Parameters and Defaults</h3>
				<div class="container">
					<div class="pre-nonumbers" style="margin-top:15px"><b>malts_mf</b>(outcome,treatment,data,discrete=[],C=1,k_tr=15,k_est=50,
	 estimator=<span class="string">"linear"</span>,smooth_cate=<span class="print">True</span>,reweight=<span class="print">False</span>,n_splits=5,
	 n_repeats=1,output_format=<span class="string">"brief"</span>)</div>
					<a onclick="expandAll(['maltsKey', 'maltsOptional']);minusAll(['plusKey', 'plusOptional'])" class="expand-all">Expand all</a>
					<a onclick="collapseAll(['maltsKey', 'maltsOptional']);plusAll(['plusKey', 'plusOptional'])" class="expand-all">Collapse all</a>
					<!--THIS HAS THE EXPAND ALL COLLAPSE ALL OPTIONS-->
				<div class="parameter-container">
					<h4 style="margin-top: 15px">Required Parameters<i id="plusKey" onclick="expand('maltsKey');minus(this.id)" class="fa fa-minus-square-o"></i></h4>
					<div id="maltsKey">
						<div class="row">
						<div class="col">
						 <table class="table table-striped" style="margin-top:15px;margin-bottom:15px;width:95%;margin-left:auto;margin-right:auto">
							<tbody>
							  <tr>
								<td class="pwidth"><b>data:</b><br>file, Dataframe, required</td>
								<td>The data to be matched. Preferably, the data should be in the form of a Python Pandas DataFrame.</td>
							  </tr>
							  <tr>
								<td><b>outcome:</b><br>string, required</td>
								<td>The column name containing the name of the outcome variable, which itself is numeric.</td>
							  </tr>
							  	<tr>
								<td><b>treated:</b><br>string, required</td>
								<td>The column name denoting whether the unit is treated or control for the matching procedure.</td>
							  </tr>
							</tbody></table>
						</div>
						</div>
					</div>
				</div><!--paramater-container over-->
				<div class="parameter-container">
					<h4 style="margin-top: 15px">Optional Parameters<i id="plusOptional" onclick="expand('maltsOptional');minus(this.id)" class="fa fa-minus-square-o"></i></h4>
					<div id = "maltsOptional">
						<div class="row">
						<div class="col">
							<table class="table table-striped" style="margin-top:15px;margin-bottom:15px;width:95%;margin-left:auto;margin-right:auto">
							<tbody>
							<tr>
								<td class="pwidth"><b>discrete:</b><br>list, default = [ ]</td>
								<td>The list of columns that have been dummified (discrete).</td>
							</tr>
							<tr>
								<td><b>C:</b><br>integer, default = 1</td>
								<td>The regularization constant used in the <span class="function">objective</span> method with the matrix.</td>
							</tr>							
							<tr>
								<td><b>k_tr:</b><br>integer, default = 15</td>
								<td>The size of the matched group in the training step.</td>
							</tr>
							<tr>
								<td><b>k_est:</b><br>integer, default = 50</td>
								<td>The size of the matched group in the estimation step.</td>
							</tr>
							<tr>
								<td><b>estimator:</b><br>string, default = 'linear'</td>
								<td>The method used to estimate the CATE value inside a matched group. The possible options are 'linear', 'mean' or 'RF', which use ridge regression, mean regression, and Random Forest regression, respectively.</td>
							</tr>
							<tr>
								<td><b>smooth_cate:</b><br>boolean, default = True</td>
								<td>Boolean to specify whether the CATE estimates should be smoothened by using a regression model to obtain a fit.</td>
							</tr>
							<tr>
								<td><b>reweight:</b><br>boolean, default = False</td>
								<td>Boolean to specify if treatment and control groups should be reweighted as per their sample sizes in the training step.</td>
							</tr>
							<tr>
								<td><b>n_splits:</b><br>integer, default = 5</td>
								<td>The number of splits of the data when n_split-fold procedure is used.</td>
							</tr>
							<tr>
								<td><b>n_repeats:</b><br>integer, default = 1</td>
								<td>The number of times the whole procedure is repeated.</td>
							</tr>
							<tr>
								<td><b>output_format:</b><br>string, default = 'brief'</td>
								<td>The style in which the output CATE dataframe is to be displayed. Possible options are 'brief' and 'full'. If 'full' is chosen, the entire dataframe is displayed, if 'brief' is chosen, only the columns <span class="function">'avg_CATE'</span>, <span class="function">'std_CATE'</span>, <span class="function">'outcome'</span>, and <span class="function">'treatment'</span> are displayed.
						</tbody></table>
						</div></div>
					</div>
					</div><!--parameter-container over-->
				</div><!--container over-->
				<h3>Examining a Matched Group Further</h3>
				<div class="container">
				We can further examine within a particular matched group, by using the <span class="function">lmplot</span> and <span class="function">regplot</span> methods within <span class="function">seaborn</span>. We can plot two different covariates for matched units for a particular unit, and find best-fit lines for the treatment units, and the control units among these matched units.
				For this, we need to obtain the data for the indices which are matched to a unit with a given index. For example, here is the code for plotting the X_1 and X_2 marginal, for the matched group for Unit-0.
				<span id="codesample6" style="display:none">MG0 = m.MG_matrix.loc[0]
matched_units_idx = MG0[MG0!=0].index 
matched_units = df.loc[matched_units_idx]
sns.lmplot(x='X1', y='X2', hue='treated', data=matched_units,palette="Set1")
plt.scatter(x=[df.loc[0,'X1']],y=[df.loc[0,'X2']],c='black',s=100)
plt.title('Matched Group for Unit-0')</span>
				
<div class="code" style="margin-top:15px"><pre>MG0 = m.MG_matrix.loc[0]
matched_units_idx = MG0[MG0!=0].index 
matched_units = df.loc[matched_units_idx]
sns.<span class="print">lmplot</span>(x=<span class="string">'X1'</span>, y=<span class="string">'X2'</span>, hue=<span class="string">'treated'</span>, data=matched_units,palette=<span class="string">"Set1"</span>)
plt.<span class="print">scatter</span>(x=[df.loc[0,'X1']],y=[df.loc[0,'X2']],c=<span class="string">'black'</span>,s=100)
plt.<span class="print">title</span>(<span class="string">'Matched Group for Unit-0'</span>)</pre><button class="codeButton" onclick="codeCopy('codesample6');showToast();borderFix()"><i class="fa fa-clipboard"></i></button></div>				
				</div><!--container over-->
				<h3>Plotting CATE against a Covariate</h3>
		<div class="container">
		We can also plot the CATE for different units against the values for a particular covariate. The following code plots CATE against Covariate X1. We can also obtain a best-fit polynomial; in the code below, we use a degree 2 polynomial.
		<span id="codesample7" style="display:none">data_w_cate = df.join(m.CATE_df, rsuffix='_').drop(columns=['outcome_','treated_']) #joining cate dataframe with data
sns.regplot( x='X1', y='avg.CATE', data=data_w_cate, scatter_kws={'alpha':0.5,'s':2}, line_kws={'color':'black'}, order=2 )</span>

<div class="code" style="margin-top:15px"><pre>data_w_cate = df.join(m.CATE_df, rsuffix=<span class="string">'_'</span>).drop(columns=[<span class="string">'outcome_'</span>,<span class="string">'treated_'</span>]) 
sns.<span class="print">regplot</span>( x=<span class="string">'X1'</span>, y=<span class="string">'avg.CATE'</span>, data=data_w_cate, scatter_kws={<span class="string">'alpha'</span>:0.5,<span class="string">'s'</span>:2}, line_kws={<span class="string">'color'</span>:<span class="string">'black'</span>}, order=2 )</pre><button class="codeButton" onclick="codeCopy('codesample7');showToast();borderFix()"><i class="fa fa-clipboard"></i></button></div>				
		
		</div><!--container over-->
		</div>
      </div></div>
	<!--/#container-fluid-done-->
	
    </div>
    <!-- /#page-content-wrapper -->

  </div>
  <!-- /#wrapper -->

  <!-- Bootstrap core JavaScript -->
  <script src="vendor/jquery/jquery.min.js"></script>
  <script src="vendor/bootstrap/js/bootstrap.bundle.min.js"></script>

  <!-- Menu Toggle Script -->
  <script>
    $("#menu-toggle").click(function(e) {
      e.preventDefault();
      $("#wrapper").toggleClass("toggled");
    });
  </script>
  <!-- Additional Custom Script -->
  <script src="additionaljs.js"></script>
</body>

</html>
